"use strict";(self.webpackChunkchurch=self.webpackChunkchurch||[]).push([[835],{7835:(A,h,o)=>{o.r(h),o.d(h,{PostsPageModule:()=>Z});var r=o(8583),d=o(9029),a=o(3971),g=o(5987),u=o(8307),p=o(5257),m=o(8002),f=o(157),t=o(7716),P=o(425),v=o(2582);function x(e,i){if(1&e&&(t.TgZ(0,"div",6),t._UZ(1,"nguix-posts",7),t.qZA()),2&e){const s=t.oxw(2);t.xp6(1),t.Q6J("i18n",!0)("posts",s.posts)}}function M(e,i){1&e&&(t.TgZ(0,"div",8),t._UZ(1,"nguix-skeleton-posts",9),t.qZA()),2&e&&(t.xp6(1),t.Q6J("no",5))}function C(e,i){1&e&&(t.TgZ(0,"div",10),t._UZ(1,"nguix-spinner"),t.qZA())}function y(e,i){if(1&e){const s=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"div",2),t.NdJ("scrolled",function(){return t.CHM(s),t.oxw().fetchPosts()}),t.YNc(2,x,2,2,"div",3),t.YNc(3,M,2,1,"ng-template",null,4,t.W1O),t.qZA(),t.YNc(5,C,2,0,"div",5),t.qZA()}if(2&e){const s=t.MAs(4),n=t.oxw();t.xp6(1),t.Q6J("infiniteScrollDistance",2)("infiniteScrollThrottle",50),t.xp6(1),t.Q6J("ngIf",n.posts.length||!n.isLoadingMore)("ngIfElse",s),t.xp6(3),t.Q6J("ngIf",n.isLoadingMore)}}const T=[{path:"",component:(()=>{class e{constructor(s,n){this.store=s,this.settingService=n,this.page$=this.settingService.onLocaleChanged.pipe((0,u.b)(l=>(this.locale=l)&&this.fetchPosts())),this.pageNo=1,this.areThereMore=!0,this.posts=[],this.isLoadingMore=!1}ngOnInit(){}fetchPosts(){if(!this.areThereMore||this.isLoadingMore)return;this.isLoadingMore=!0,setTimeout(()=>this.isLoadingMore=!1,3e3);const s=`post:default:publish:${this.locale}`;this.latestQueryId=`${s}:${this.pageNo++}`,this.store.dispatch(new f.G3(this.latestQueryId,n=>{let l=n.where("type","==","default").where("status","==","publish").where("locale","==",this.locale).orderBy("createdAt","desc");return this.latestItem&&(l=l.startAfter(this.latestItem.createdAt)),l.limit(12)})).pipe((0,p.q)(1),(0,m.U)(n=>n.schemata_post)).subscribe(n=>{const l=n.queryList[this.latestQueryId];this.areThereMore=!!l.length,this.latestItem=this.areThereMore?l[l.length-1]:this.latestItem,this.posts=Object.keys(n.queryList).filter(c=>c.includes(s)).reduce((c,L)=>c.concat(n.queryList[L]),[]),this.isLoadingMore=!1})}}return e.\u0275fac=function(s){return new(s||e)(t.Y36(P.yh),t.Y36(v.RC))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-posts-page"]],decls:2,vars:3,consts:[["class","host",4,"ngIf"],[1,"host"],["infiniteScroll","",1,"listing",3,"infiniteScrollDistance","infiniteScrollThrottle","scrolled"],["class","main",4,"ngIf","ngIfElse"],["listLoading",""],["class","infinite-loading",4,"ngIf"],[1,"main"],["layout","card","authorUrlSegment","member",3,"i18n","posts"],[1,"list-loading"],["layout","card",3,"no"],[1,"infinite-loading"]],template:function(s,n){1&s&&(t.YNc(0,y,6,5,"div",0),t.ALo(1,"async")),2&s&&t.Q6J("ngIf",t.lcZ(1,1,n.page$))},directives:[r.O5,d.R,a.PostsComponent,a.SkeletonPostsComponent,a.SpinnerComponent],pipes:[r.Ov],styles:[".host[_ngcontent-%COMP%]{padding:1rem 1rem 0;max-width:992px;margin:auto}.host[_ngcontent-%COMP%]   .listing[_ngcontent-%COMP%]{min-height:100vh}.host[_ngcontent-%COMP%]   .infinite-loading[_ngcontent-%COMP%]{padding-bottom:1rem;display:flex;justify-content:center}"]}),e})()}];let I=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[g.Bz.forChild(T)],g.Bz]}),e})(),Z=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[r.ez,d.X,a.NguixSpinnerComponentModule,a.NguixPostsI18nComponentModule,a.NguixSkeletonPostsComponentModule,I]]}),e})()}}]);