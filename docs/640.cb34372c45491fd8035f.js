"use strict";(self.webpackChunkchurch=self.webpackChunkchurch||[]).push([[640],{9548:(w,p,i)=>{i.r(p),i.d(p,{VideosPageModule:()=>N});var g=i(8583),f=i(9029),d=i(2582),l=i(3971),u=i(5987),M=i(739),O=i(8307),m=i(5257),v=i(8002),C=i(157),t=i(7716),P=i(425);const y=function(e){return["videos","category",e]};function x(e,r){if(1&e&&(t.TgZ(0,"li"),t.TgZ(1,"a",10),t._uU(2),t.qZA(),t.qZA()),2&e){const n=r.$implicit;t.xp6(1),t.Q6J("usefulRouterLink",t.VKq(2,y,n.id)),t.xp6(1),t.Oqu(n.title)}}function _(e,r){if(1&e&&(t.TgZ(0,"div",11),t._UZ(1,"nguix-videos",12),t.qZA()),2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("i18n",!0)("videos",n.videos)}}function T(e,r){1&e&&(t.TgZ(0,"div",13),t._UZ(1,"nguix-skeleton-videos",14),t.qZA()),2&e&&(t.xp6(1),t.Q6J("no",5))}function b(e,r){1&e&&(t.TgZ(0,"div",15),t._UZ(1,"nguix-spinner"),t.qZA())}const Z=function(){return["videos"]},V=function(){return{exact:!0}};function I(e,r){if(1&e){const n=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"div",2),t.TgZ(2,"ul"),t.TgZ(3,"li"),t.TgZ(4,"a",3),t._uU(5,"Home"),t.qZA(),t.qZA(),t.YNc(6,x,3,4,"li",4),t.qZA(),t.qZA(),t.TgZ(7,"div",5),t.TgZ(8,"div",6),t.NdJ("scrolled",function(){return t.CHM(n),t.oxw().fetchVideos()}),t.YNc(9,_,2,2,"div",7),t.YNc(10,T,2,1,"ng-template",null,8,t.W1O),t.qZA(),t.YNc(12,b,2,0,"div",9),t.qZA(),t.qZA()}if(2&e){const n=t.MAs(11),o=t.oxw();t.xp6(4),t.Q6J("usefulRouterLink",t.DdM(8,Z))("usefulRouterLinkActiveOptions",t.DdM(9,V)),t.xp6(2),t.Q6J("ngForOf",o.categories),t.xp6(2),t.Q6J("infiniteScrollDistance",2)("infiniteScrollThrottle",50),t.xp6(1),t.Q6J("ngIf",o.videos.length||!o.isLoadingMore)("ngIfElse",n),t.xp6(3),t.Q6J("ngIf",o.isLoadingMore)}}const A=[{path:"",component:(()=>{class e{constructor(n,o,c){this.route=n,this.store=o,this.settingService=c,this.page$=(0,M.aj)([this.route.params,this.settingService.onLocaleChanged]).pipe((0,O.b)(([s,a])=>{this.locale=a,this.categories.length||this.fetchCategories(),this.activeGroupName=s.categoryId?s.categoryId:"all",this.groupingTracker[this.activeGroupName]||(this.groupingTracker[this.activeGroupName]={latestQueryId:"",latestItem:void 0,pageNo:1,areThereMore:!0}),this.fetchVideos()})),this.groupingTracker={},this.activeGroupName="all",this.categories=[],this.videos=[],this.isLoadingMore=!1}ngOnInit(){}fetchVideos(){const n=this.groupingTracker[this.activeGroupName];if(!n.areThereMore||this.isLoadingMore)return;this.isLoadingMore=!0,setTimeout(()=>this.isLoadingMore=!1,3e3);const o=`video:default:publish:${this.locale}:${this.activeGroupName}`;return n.latestQueryId=`${o}:${n.pageNo++}`,this.store.dispatch(new C.lz(n.latestQueryId,c=>{let s=c.where("type","==","default").where("status","==","publish").where("locale","==",this.locale).orderBy("createdAt","desc");if("all"!==this.activeGroupName){const a=this.activeGroupName;s=s.where(`categories.${a}.id`,"==",a)}return n.latestItem&&(s=s.startAfter(n.latestItem.createdAt)),s.limit(3)})).pipe((0,m.q)(1),(0,v.U)(c=>c.schemata_video)).subscribe(c=>{const s=this.groupingTracker[this.activeGroupName],a=c.queryList[s.latestQueryId];s.areThereMore=!!a.length,s.latestItem=s.areThereMore?a[a.length-1]:s.latestItem,this.videos=Object.keys(c.queryList).filter(h=>h.includes(o)).reduce((h,k)=>h.concat(c.queryList[k]),[]),this.isLoadingMore=!1})}fetchCategories(){const n=`category:video_category:publish:${this.locale}`;return this.store.dispatch(new C.k2(n,o=>o.where("type","==","video_category").where("status","==","publish").where("locale","==",this.locale).orderBy("count","desc"))).pipe((0,m.q)(1),(0,v.U)(o=>o.schemata_category)).subscribe(o=>this.categories=o.queryList[n])}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(u.gz),t.Y36(P.yh),t.Y36(d.RC))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-videos-page"]],decls:2,vars:3,consts:[["class","host",4,"ngIf"],[1,"host"],[1,"toolbar"],["usefulRouterLinkActive","active",3,"usefulRouterLink","usefulRouterLinkActiveOptions"],[4,"ngFor","ngForOf"],[1,"body"],["infiniteScroll","",1,"listing",3,"infiniteScrollDistance","infiniteScrollThrottle","scrolled"],["class","main",4,"ngIf","ngIfElse"],["listLoading",""],["class","infinite-loading",4,"ngIf"],["usefulRouterLinkActive","active",3,"usefulRouterLink"],[1,"main"],["layout","card",3,"i18n","videos"],[1,"list-loading"],["layout","card",3,"no"],[1,"infinite-loading"]],template:function(n,o){1&n&&(t.YNc(0,I,13,10,"div",0),t.ALo(1,"async")),2&n&&t.Q6J("ngIf",t.lcZ(1,1,o.page$))},directives:[g.O5,d.jY,g.sg,f.R,l.VideosComponent,l.SkeletonVideosComponent,l.SpinnerComponent],pipes:[g.Ov],styles:[".host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{width:100%;height:49px;position:fixed;top:65px;left:0;right:0;z-index:1;background:var(--app-color-background-tint);border-bottom:1px solid var(--app-color-background);padding:.5rem 1rem}.host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{flex:1;width:100%;margin:0;padding:0;list-style:none;display:flex;flex-wrap:nowrap;align-items:center;overflow-x:scroll;overflow-y:hidden;-ms-overflow-style:none;scrollbar-width:none}.host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-left:1rem}.host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child{margin-left:0}.host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;text-decoration:none;color:var(--app-color-medium)}.host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus, .host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:var(--app-color-foreground)}.host[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{line-height:0;padding:1rem .75rem;font-size:.9rem;background:var(--app-color-background-shade);border-radius:var(--app-size-radius)}.host[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:65px 1rem 0;max-width:992px;margin:auto}.host[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .listing[_ngcontent-%COMP%]{min-height:100vh}.host[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .infinite-loading[_ngcontent-%COMP%]{padding-bottom:1rem;display:flex;justify-content:center}"]}),e})()}];let L=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.Bz.forChild(A)],u.Bz]}),e})(),N=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[g.ez,f.X,d.Pf,l.NguixSpinnerComponentModule,l.NguixVideosI18nComponentModule,l.NguixSkeletonVideosComponentModule,L]]}),e})()}}]);