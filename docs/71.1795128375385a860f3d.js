"use strict";(self.webpackChunkchurch=self.webpackChunkchurch||[]).push([[71],{5071:(st,Z,c)=>{c.r(Z),c.d(Z,{SearchPageModule:()=>it});var p=c(8583),v=c(3679),l=c(3971),x=c(5987),P=c(739),T=c(5917),q=c(8307),C=c(5435),d=c(5257),_=c(8002),A=c(3190),g=c(157),t=c(7716),O=c(425),m=c(2582);function y(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"li"),t.TgZ(1,"a",15),t.NdJ("click",function(){const h=t.CHM(e).$implicit;return t.oxw(3).selectQuery(h.title),!1}),t._uU(2),t.qZA(),t.qZA()}if(2&i){const e=o.$implicit;t.xp6(2),t.Oqu(e.title)}}function I(i,o){if(1&i&&(t.TgZ(0,"ul",13),t.YNc(1,y,3,1,"li",14),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.topQueries)}}function b(i,o){1&i&&(t.TgZ(0,"div",29),t._UZ(1,"nguix-spinner"),t.qZA())}function Q(i,o){1&i&&(t.TgZ(0,"div",30),t.TgZ(1,"button",31),t._uU(2,"See more"),t.qZA(),t.qZA())}function N(i,o){if(1&i&&(t.TgZ(0,"div"),t.TgZ(1,"div",25),t._UZ(2,"nguix-posts",26),t.qZA(),t.YNc(3,b,2,0,"div",27),t.YNc(4,Q,3,0,"div",28),t.qZA()),2&i){const e=t.oxw(4);t.xp6(2),t.Q6J("i18n",!0)("posts",e.posts),t.xp6(1),t.Q6J("ngIf",e.isPostLoadingMore),t.xp6(1),t.Q6J("ngIf",e.postResult&&e.postPage<e.postTotalPages)}}function L(i,o){1&i&&(t.TgZ(0,"div",32),t._uU(1,"No news found."),t.qZA())}function w(i,o){if(1&i&&(t.ynx(0),t.YNc(1,N,5,4,"div",22),t.YNc(2,L,2,0,"ng-template",null,24,t.W1O),t.BQk()),2&i){const e=t.MAs(3),n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",n.posts.length)("ngIfElse",e)}}function Y(i,o){1&i&&t._UZ(0,"nguix-skeleton-posts",33),2&i&&t.Q6J("no",3)}function J(i,o){if(1&i&&(t.TgZ(0,"section",16),t.TgZ(1,"div",17),t.TgZ(2,"div",18),t._uU(3,"News"),t.qZA(),t.TgZ(4,"div",19),t.TgZ(5,"span",20),t._uU(6),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"div",21),t.YNc(8,w,4,2,"ng-container",22),t.YNc(9,Y,1,1,"ng-template",null,23,t.W1O),t.qZA(),t.qZA()),2&i){const e=t.MAs(10),n=t.oxw(2);t.xp6(6),t.Oqu(n.postCount),t.xp6(2),t.Q6J("ngIf",!n.isPostLoading)("ngIfElse",e)}}function U(i,o){1&i&&(t.TgZ(0,"div",29),t._UZ(1,"nguix-spinner"),t.qZA())}function R(i,o){1&i&&(t.TgZ(0,"div",30),t.TgZ(1,"button",31),t._uU(2,"See more"),t.qZA(),t.qZA())}function z(i,o){if(1&i&&(t.TgZ(0,"div"),t.TgZ(1,"div",25),t._UZ(2,"nguix-videos",38),t.qZA(),t.YNc(3,U,2,0,"div",27),t.YNc(4,R,3,0,"div",28),t.qZA()),2&i){const e=t.oxw(4);t.xp6(2),t.Q6J("i18n",!0)("videos",e.videos),t.xp6(1),t.Q6J("ngIf",e.isPostLoadingMore),t.xp6(1),t.Q6J("ngIf",e.videoResult&&e.videoPage<e.videoTotalPages)}}function V(i,o){1&i&&(t.TgZ(0,"div",32),t._uU(1,"No videos found."),t.qZA())}function k(i,o){if(1&i&&(t.ynx(0),t.YNc(1,z,5,4,"div",22),t.YNc(2,V,2,0,"ng-template",null,37,t.W1O),t.BQk()),2&i){const e=t.MAs(3),n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",n.videos.length)("ngIfElse",e)}}function D(i,o){1&i&&t._UZ(0,"nguix-skeleton-videos",33),2&i&&t.Q6J("no",3)}function E(i,o){if(1&i&&(t.TgZ(0,"section",34),t.TgZ(1,"div",17),t.TgZ(2,"div",18),t._uU(3,"Videos"),t.qZA(),t.TgZ(4,"div",19),t.TgZ(5,"span",35),t._uU(6),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"div",21),t.YNc(8,k,4,2,"ng-container",22),t.YNc(9,D,1,1,"ng-template",null,36,t.W1O),t.qZA(),t.qZA()),2&i){const e=t.MAs(10),n=t.oxw(2);t.xp6(6),t.Oqu(n.videoCount),t.xp6(2),t.Q6J("ngIf",!n.isVideoLoading)("ngIfElse",e)}}function F(i,o){1&i&&(t.TgZ(0,"div",29),t._UZ(1,"nguix-spinner"),t.qZA())}function B(i,o){1&i&&(t.TgZ(0,"div",30),t.TgZ(1,"button",31),t._uU(2,"See more"),t.qZA(),t.qZA())}function W(i,o){if(1&i&&(t.TgZ(0,"div"),t.TgZ(1,"div",25),t._UZ(2,"nguix-posts",43),t.qZA(),t.YNc(3,F,2,0,"div",27),t.YNc(4,B,3,0,"div",28),t.qZA()),2&i){const e=t.oxw(4);t.xp6(2),t.Q6J("i18n",!0)("posts",e.articles),t.xp6(1),t.Q6J("ngIf",e.isArticleLoadingMore),t.xp6(1),t.Q6J("ngIf",e.articleResult&&e.articlePage<e.articleTotalPages)}}function j(i,o){1&i&&(t.TgZ(0,"div",32),t._uU(1,"No articles found."),t.qZA())}function $(i,o){if(1&i&&(t.ynx(0),t.YNc(1,W,5,4,"div",22),t.YNc(2,j,2,0,"ng-template",null,42,t.W1O),t.BQk()),2&i){const e=t.MAs(3),n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",n.articles.length)("ngIfElse",e)}}function H(i,o){1&i&&t._UZ(0,"nguix-skeleton-posts",33),2&i&&t.Q6J("no",3)}function K(i,o){if(1&i&&(t.TgZ(0,"section",39),t.TgZ(1,"div",17),t.TgZ(2,"div",18),t._uU(3,"Articles"),t.qZA(),t.TgZ(4,"div",19),t.TgZ(5,"span",40),t._uU(6),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"div",21),t.YNc(8,$,4,2,"ng-container",22),t.YNc(9,H,1,1,"ng-template",null,41,t.W1O),t.qZA(),t.qZA()),2&i){const e=t.MAs(10),n=t.oxw(2);t.xp6(6),t.Oqu(n.articleCount),t.xp6(2),t.Q6J("ngIf",!n.isArticleLoading)("ngIfElse",e)}}function X(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"div",2),t.TgZ(1,"div",3),t.TgZ(2,"div",4),t.TgZ(3,"input",5),t.NdJ("ngModelChange",function(a){return t.CHM(e),t.oxw().query=a})("keyup.enter",function(){return t.CHM(e),t.oxw().search()}),t.qZA(),t.TgZ(4,"button",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().search()}),t._UZ(5,"i",7),t.qZA(),t.qZA(),t.YNc(6,I,2,1,"ul",8),t.qZA(),t.TgZ(7,"div",9),t.YNc(8,J,11,3,"section",10),t.YNc(9,E,11,3,"section",11),t.YNc(10,K,11,3,"section",12),t.qZA(),t.qZA()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngModel",e.query),t.xp6(3),t.Q6J("ngIf",e.topQueries.length),t.xp6(2),t.Q6J("ngIf",e.postResult),t.xp6(1),t.Q6J("ngIf",e.videoResult),t.xp6(1),t.Q6J("ngIf",e.articleResult)}}function G(i,o){1&i&&(t.TgZ(0,"div",44),t._UZ(1,"nguix-spinner"),t.qZA())}const tt=[{path:"",component:(()=>{class i{constructor(e,n,a,h,u,S,f,nt,ot){this.route=e,this.store=n,this.helperService=a,this.navService=h,this.settingService=u,this.userService=S,this.tagDataService=f,this.postDataService=nt,this.videoDataService=ot,this.page$=(0,P.aj)([this.route.queryParams,this.tagDataService.setupSearching(!0),this.postDataService.setupSearching(),this.videoDataService.setupSearching()]).pipe((0,q.b)(([M])=>{this.articleSearchContext=this.postDataService.createSearchIndex(s=>!!s&&"article"===s.type&&"publish"===s.status&&s.locale===this.settingService.locale),M.q?this.selectQuery(M.q):(this.store.select(s=>{var r;return null===(r=s.schemata_post.searchList)||void 0===r?void 0:r[this.postSearchId]}).pipe((0,C.h)(s=>!!s),(0,d.q)(1)).subscribe(s=>this.handlePostSearch(s)),this.store.select(s=>{var r;return null===(r=s.schemata_post.searchList)||void 0===r?void 0:r[this.articleSearchId]}).pipe((0,C.h)(s=>!!s),(0,d.q)(1)).subscribe(s=>this.handleArticleSearch(s)),this.store.select(s=>{var r;return null===(r=s.schemata_video.searchList)||void 0===r?void 0:r[this.videoSearchId]}).pipe((0,C.h)(s=>!!s),(0,d.q)(1)).subscribe(s=>this.handleVideoSearch(s)))})),this.viewSize=12,this.topQueries=[],this.query="",this.postSearchId="post",this.isPostLoading=!1,this.isPostLoadingMore=!1,this.posts=[],this.postCount=0,this.postTotalPages=0,this.postPage=1,this.articleSearchId="article",this.isArticleLoading=!1,this.isArticleLoadingMore=!1,this.articles=[],this.articleCount=0,this.articleTotalPages=0,this.articlePage=1,this.videoSearchId="video",this.isVideoLoading=!1,this.isVideoLoadingMore=!1,this.videos=[],this.videoCount=0,this.videoTotalPages=0,this.videoPage=1}ngOnInit(){this.loadTopQueries()}selectQuery(e){this.query=e,this.search()}search(){!this.query||(this.navService.updateQueryParams({q:this.query}),this.isPostLoading=!0,this.store.dispatch(new g.s(this.postSearchId,this.query,this.viewSize)).pipe((0,d.q)(1),(0,_.U)(e=>{var n;return null===(n=e.schemata_post.searchList)||void 0===n?void 0:n[this.postSearchId]})).subscribe(e=>this.handlePostSearch(e)),this.isArticleLoading=!0,this.store.dispatch(new g.s(this.articleSearchId,this.query,this.viewSize,this.articleSearchContext)).pipe((0,d.q)(1),(0,_.U)(e=>{var n;return null===(n=e.schemata_post.searchList)||void 0===n?void 0:n[this.articleSearchId]})).subscribe(e=>this.handleArticleSearch(e)),this.isVideoLoading=!0,this.store.dispatch(new g.r$(this.videoSearchId,this.query,this.viewSize)).pipe((0,d.q)(1),(0,_.U)(e=>{var n;return null===(n=e.schemata_video.searchList)||void 0===n?void 0:n[this.videoSearchId]})).subscribe(e=>this.handleVideoSearch(e)),this.saveQuery(this.query))}loadMorePosts(){!this.postResult||(this.isPostLoadingMore=!0,this.store.dispatch(new g.Nn(this.postSearchId,++this.postPage)).pipe((0,d.q)(1),(0,_.U)(e=>{var n;return null===(n=e.schemata_post.searchList)||void 0===n?void 0:n[this.postSearchId]})).subscribe(e=>{this.posts=e.items,this.isPostLoadingMore=!1}))}loadMoreArticles(){!this.postResult||(this.isArticleLoadingMore=!0,this.store.dispatch(new g.Nn(this.articleSearchId,++this.articlePage)).pipe((0,d.q)(1),(0,_.U)(e=>{var n;return null===(n=e.schemata_post.searchList)||void 0===n?void 0:n[this.articleSearchId]})).subscribe(e=>{this.articles=e.items,this.isArticleLoadingMore=!1}))}loadMoreVideos(){!this.videoResult||(this.isVideoLoadingMore=!0,this.store.dispatch(new g.Jy(this.videoSearchId,++this.videoPage)).pipe((0,d.q)(1),(0,_.U)(e=>{var n;return null===(n=e.schemata_video.searchList)||void 0===n?void 0:n[this.videoSearchId]})).subscribe(e=>{this.videos=e.items,this.isVideoLoadingMore=!1}))}handlePostSearch(e){this.postResult=e.result,this.posts=e.items,this.postCount=this.postResult.count(),this.postTotalPages=Math.ceil(this.postCount/this.viewSize),this.query||(this.query=e.query),this.isPostLoading=!1}handleArticleSearch(e){this.articleResult=e.result,this.articles=e.items,this.articleCount=this.articleResult.count(),this.articleTotalPages=Math.ceil(this.articleCount/this.viewSize),this.query||(this.query=e.query),this.isArticleLoading=!1}handleVideoSearch(e){this.videoResult=e.result,this.videos=e.items,this.videoCount=this.videoResult.count(),this.videoTotalPages=Math.ceil(this.videoCount/this.viewSize),this.query||(this.query=e.query),this.isVideoLoading=!1}loadTopQueries(){this.tagDataService.list(e=>e.where("status","==","publish").where("type","==","search").orderBy("createdAt","desc").limit(30),{name:"tag:search:publish:latest-top-queries"}).pipe((0,_.U)(e=>e.sort((n,a)=>(n.count||0)>(a.count||0)?-1:1))).subscribe(e=>this.topQueries=e.slice(0,5))}saveQuery(e){const n=this.userService.uid||"",a=e,h=this.helperService.slugify(a),u=(new Date).toISOString(),S={uid:n,title:a,id:h,type:"search",status:"draft",createdAt:u,updatedAt:u,count:1};this.tagDataService.get(h).pipe((0,A.w)(f=>f?"search"===f.type?this.tagDataService.increment(h,{count:1}):(0,T.of)(!1):this.tagDataService.create(h,S,!0))).subscribe()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(x.gz),t.Y36(O.yh),t.Y36(m.W_),t.Y36(m.tZ),t.Y36(m.RC),t.Y36(m.KD),t.Y36(g.dF),t.Y36(g.Vz),t.Y36(g.Er))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-search-page"]],decls:4,vars:4,consts:[["class","host",4,"ngIf","ngIfElse"],["loading",""],[1,"host"],[1,"form"],[1,"input"],["type","search","placeholder","Search for news, articles, videos, ...",1,"form-control",3,"ngModel","ngModelChange","keyup.enter"],[1,"button-primary",3,"click"],[1,"icon-light","icon-search"],["class","top-queries",4,"ngIf"],[1,"result"],["class","posts",4,"ngIf"],["class","videos",4,"ngIf"],["class","articles",4,"ngIf"],[1,"top-queries"],[4,"ngFor","ngForOf"],["href","#",3,"click"],[1,"posts"],[1,"title"],[1,"text"],[1,"count"],[1,"badge-secondary"],[1,"body"],[4,"ngIf","ngIfElse"],["postLoading",""],["noPosts",""],[1,"items"],["layout","thumbnail","authorPath","member",3,"i18n","posts"],["class","loading-more",4,"ngIf"],["class","more",4,"ngIf"],[1,"loading-more"],[1,"more"],[1,"button-outline-medium"],[1,"no-items"],["layout","thumbnail",3,"no"],[1,"videos"],[1,"badge-danger"],["videoLoading",""],["noVideos",""],["layout","thumbnail",3,"i18n","videos"],[1,"articles"],[1,"badge-tertiary"],["articleLoading",""],["noArticles",""],["layout","thumbnail","postPath","article","authorPath","member",3,"i18n","posts"],[1,"loading"]],template:function(e,n){if(1&e&&(t.YNc(0,X,11,5,"div",0),t.ALo(1,"async"),t.YNc(2,G,2,0,"ng-template",null,1,t.W1O)),2&e){const a=t.MAs(3);t.Q6J("ngIf",t.lcZ(1,2,n.page$))("ngIfElse",a)}},directives:[p.O5,v.Fj,v.JJ,v.On,p.sg,l.PostsComponent,l.SpinnerComponent,l.SkeletonPostsComponent,l.VideosComponent,l.SkeletonVideosComponent],pipes:[p.Ov],styles:[".host[_ngcontent-%COMP%]{max-width:768px;margin:auto}.host[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{padding:1rem 1rem .5rem;background:var(--app-color-background-tint)}.host[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]{display:flex;flex-wrap:nowrap;align-items:center}.host[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:0;border-radius:var(--app-size-radius) 0 0 var(--app-size-radius)}.host[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:0;border-radius:0 var(--app-size-radius) var(--app-size-radius) 0;height:2.4rem}.host[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:1.5rem;height:1.75rem}.host[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .top-queries[_ngcontent-%COMP%]{margin:0;padding:0;list-style:none;display:flex;flex-wrap:wrap;align-items:center}.host[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .top-queries[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-right:.5rem}.host[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .top-queries[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:.85rem;color:var(--app-color-medium)}.host[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]{padding:1rem}.host[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{padding:1rem;margin-bottom:2rem;background:var(--app-color-background-tint);border-radius:var(--app-size-radius)}.host[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;padding-bottom:.5rem;border-bottom:1px solid var(--app-color-background-shade);color:var(--app-color-medium)}.host[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex:1;text-transform:uppercase;font-weight:700}.host[_ngcontent-%COMP%]   .result[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{margin-top:1rem}.loading[_ngcontent-%COMP%]{padding:2rem;display:flex;justify-content:center}"]}),i})()}];let et=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[x.Bz.forChild(tt)],x.Bz]}),i})(),it=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[p.ez,v.u5,l.NguixSpinnerComponentModule,l.NguixPostsI18nComponentModule,l.NguixSkeletonPostsComponentModule,l.NguixVideosI18nComponentModule,l.NguixSkeletonVideosComponentModule,et]]}),i})()}}]);